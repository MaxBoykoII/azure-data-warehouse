trigger:
  - main

variables:
  - name: deploymentLocation
    value: eastus

  - name: azureResourceManagerConnection
    value: az-dw-arm-sc

pool:
  vmImage: ubuntu-latest

steps:
  - checkout: self

  - bash: az bicep build --file ./deployment/main.bicep
    displayName: "TEST: Transpile bicep"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "TEST: Deploy Main Template"
    inputs:
      azureResourceManagerConnection: $(azureResourceManagerConnection)
      deploymentScope: "Subscription"
      location: $(deploymentLocation)
      templateLocation: "Linked artifact"
      csmFile: "./deployment/main.json"
      deploymentMode: "Incremental"
